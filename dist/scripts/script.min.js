angular.module("WigeonApp",["ngRoute","ngCookies"]);var appRun=function(e,t,n){function o(){var n=t.get("wigeon_user_token");return e.SignedIn=n,n}e.SignedIn=o(),e.facebookAppId="872785199480947",e.baseApiUrl="http://52.201.120.48/Wigeon/scripts/",e.types={0:{title:"ALL",name:"All Suggestions",id:"0"},1:{title:"WATCH",name:"Watch",img:"/assets/images/wigeon-webapp_watch-black.png",id:"1",color:"#4257A6"},2:{title:"LISTEN",name:"Listen",img:"/assets/images/wigeon-webapp_listen-black.png",id:"2",color:"#F37221"},3:{title:"GO",name:"Go",img:"/assets/images/wigeon-webapp_go-black.png",id:"3",color:"#FEBC22"},4:{title:"READ",name:"Read",img:"/assets/images/wigeon-webapp_read-black.png",id:"4",color:"#D83939"},5:{title:"OTHER",name:"Other",img:"/assets/images/wigeon-webapp_other-black.png",id:"5",color:"#1C706F"}},e.SignOut=function(){t.remove("wigeon_user_token"),e.IsUserSignedIn(),n.location.href="/sign-in"},e.IsUserSignedIn=function(){o()},e.calculateTimeDifference=function(e){var t=new Date(1e3*e),n=new Date,o=parseInt((n-t)/864e5);if(o>=1)return o+"d ago";var i=parseInt((n-t)/36e5);return 1===i||0===i?"1h ago":i+"h ago"},window.fbAsyncInit=function(){FB.init({appId:e.facebookAppId,cookie:!0,xfbml:!0,version:"v2.5"}),FB.Event.subscribe("auth.statusChange",function(t){e.$broadcast("fb_statusChange",{status:t.status})})},function(e,t,n){var o,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")};appRun.$inject=["$rootScope","$cookies","$window"],angular.module("WigeonApp").run(appRun);var appRoutes=function(e,t){"use strict";e.when("/sign-in",{templateUrl:"views/sign-in.html"}).when("/sign-up",{templateUrl:"views/sign-up.html"}).when("/nest",{templateUrl:"views/nest.html"}).when("/profile",{templateUrl:"views/profile.html"}).otherwise({redirectTo:"/sign-in"}),t.html5Mode(!0)};appRoutes.$inject=["$routeProvider","$locationProvider"],angular.module("WigeonApp").config(appRoutes);var NestCtrl=function(e,t,n,o,i,r,s,a){"use strict";function c(){var e=n.get("wigeon_user_token");return e?void u():void(o.location.href="/sign-in")}function u(){var t=i.fetch(1,0);t.then(function(t){e.suggestions=t;var n=i.fetch(10,1);n.then(function(t){e.suggestions=e.suggestions.concat(t)})})}function l(t){var n,o;n=e.suggestions;for(var i=0;i<n.length;i++)if(t==n[i].inbox_suggestion.suggestion_id){o=n[i].inbox_suggestion;break}return o}function g(){$(document).ready(function(){$("#NestCtrl").on("hidden.bs.modal","#SuggestionDetailModal",function(){var e=$("#MusicPreview")[0];void 0!==e?e.pause():h.isVideo&&h.player.destroy()}),$("#NestCtrl").on("shown.bs.modal","#SuggestionDetailModal",function(){h.isVideo&&(h.player=new YT.Player("ytplayer",{height:"390",width:"100%",videoId:e.suggestionModelInfo.suggestion_source_item_id,events:{}}))}),$(".search-icon").on("click",function(){$(".search-suggestions").show("slow")}),$(".close-search").on("click",function(){$(".search-suggestions").hide("slow")}),$(".sort-buttons li").on("click",function(){var e=$(".sort-buttons span.active"),t="#"+$(".sort-buttons span.active").siblings("a").children("img").prop("id");m(t),e.removeClass("active"),$(this).children(".filter-bullet").addClass("active");var n="#"+$(".sort-buttons span.active").siblings("a").children("img").prop("id");m(n)}),$(".profile-link").removeClass("active"),$(".nest-header-item").addClass("active")})}function p(){e.quantity+=20}function f(){r.userImg=n.get("wigeon_user_img")}function d(e,t){h.filterViewName=e}function m(e){var t=$(e).prop("src"),n=v(t);$(e).prop("src",n)}function v(e){return e.indexOf("green")>0?e=e.replace("green","black"):e.indexOf("black")>0&&(e=e.replace("black","green")),e}const h=this;c(),g(),f(),e.view="GRID",e.quantity=20,h.filterViewName="All Suggestions",h.swapFilterViewName=d,h.seeMore=p,h.isVideo=!1,h.player,e.populateModal=function(t){var n=l(t);if(e.suggestionModelInfo=n,"GO"===n.suggestion_type.title){var o=a.fetch(n.suggestion_source_item_id);o.then(function(t){e.yelp=t,$("#SuggestionDetailModal").modal()})}else h.isVideo="WATCH"===n.suggestion_type.title,$("#SuggestionDetailModal").modal()},e.getIframeSrc=function(e){return s.trustAsResourceUrl("https://www.youtube.com/embed/"+e+"?enablejsapi=1")},e.returnTrustedSrc=function(e){return e=e+"?cb="+(new Date).getTime(),s.trustAsResourceUrl(e)},e.changeLayout=function(t){$(".layout-buttons a").each(function(){$(this).removeClass("active")}),$("#"+t+"-LAYOUT").addClass("active"),e.view=t}};NestCtrl.$inject=["$scope","$http","$cookies","$window","SuggestionFactory","$rootScope","$sce","YelpFactory"],angular.module("WigeonApp").controller("NestCtrl",NestCtrl);var ProfileCtrl=function(e,t,n,o,i,r,s,a){"use strict";function c(){var e=n.get("wigeon_user_token");e||(o.location.href="/sign-in"),u(),l()}function u(){i.getProfile().then(function(t){var n=JSON.parse(t);void 0==r.userImg&&(r.userImg=e.getProfileImg(n.user_profile_image)),e.profile=n})}function l(){i.getUserFeed(1,0).then(function(t){e.suggestions=t.data,i.getUserFeed(10,1).then(function(t){e.suggestions=e.suggestions.concat(t.data)})})}function g(t){var n,o;n=e.suggestions;for(var i=0;i<n.length;i++)if(t==n[i].feed_suggestion.suggestion_id){o=n[i].feed_suggestion;break}return o}function p(){$(document).ready(function(){$("#ProfileCtrl").on("hidden.bs.modal","#SuggestionDetailModal",function(){var e=$("#MusicPreview")[0];void 0!==e?e.pause():v.isVideo&&v.player.destroy()}),$("#ProfileCtrl").on("shown.bs.modal","#SuggestionDetailModal",function(){v.isVideo&&(v.player=new YT.Player("ytplayer",{height:"390",width:"100%",videoId:e.suggestionModelInfo.suggestion_source_item_id,events:{}}))}),$(".search-icon").on("click",function(){$(".search-suggestions").show("slow")}),$(".close-search").on("click",function(){$(".search-suggestions").hide("slow")}),$(".sort-buttons li").on("click",function(){var e=$(".sort-buttons span.active"),t="#"+$(".sort-buttons span.active").siblings("a").children("img").prop("id");d(t),e.removeClass("active"),$(this).children(".filter-bullet").addClass("active");var n="#"+$(".sort-buttons span.active").siblings("a").children("img").prop("id");d(n)}),$(".nest-header-item").removeClass("active"),$(".profile-link").addClass("active")})}function f(){e.quantity+=20}function d(e){var t=$(e).prop("src"),n=m(t);$(e).prop("src",n)}function m(e){return e.indexOf("green")>0?e=e.replace("green","black"):e.indexOf("black")>0&&(e=e.replace("black","green")),e}const v=this;c(),p(),e.view="GRID",e.quantity=20,v.filterViewName="All Suggestions",v.seeMore=f,v.isVideo=!1,v.player,e.populateModal=function(t){var n=g(t);if(e.suggestionModelInfo=n,"GO"===n.suggestion_type.title){var o=a.fetch(n.suggestion_source_item_id);o.then(function(t){e.yelp=t,$("#SuggestionDetailModal").modal()})}else v.isVideo="WATCH"===n.suggestion_type.title,$("#SuggestionDetailModal").modal()},e.getIframeSrc=function(e){return s.trustAsResourceUrl("https://www.youtube.com/embed/"+e+"?enablejsapi=1")},e.returnTrustedSrc=function(e){return e=e+"?cb="+(new Date).getTime(),s.trustAsResourceUrl(e)},e.changeLayout=function(t){$(".layout-buttons a").each(function(){$(this).removeClass("active")}),$("#"+t+"-LAYOUT").addClass("active"),e.view=t},e.getProfileImg=function(e){if(void 0!==e)return e.indexOf("http")===-1?"http://52.201.120.48/Wigeon/"+e:e},e.SignOut=function(){n.remove("wigeon_user_token"),o.location.href="/sign-in"}};ProfileCtrl.$inject=["$scope","$http","$cookies","$window","ProfileService","$rootScope","$sce","YelpFactory"],angular.module("WigeonApp").controller("ProfileCtrl",ProfileCtrl);var SignInCtrl=function(e,t,n,o,i,r,s,a){"use strict";function c(){var e=n.get("wigeon_user_token");e&&(i.location.href="/nest")}function u(e){if("connected"===e.status){var t=r.getMyLastName();t.then(function(e){var t=l(e);t.then(function(e){e.success?(g(e.user_img),s.IsUserSignedIn(),i.location.href="/nest"):alert(e.error_message)})})}else"not_authorized"===e.status?document.getElementById("status").innerHTML="Please log into this app.":document.getElementById("status").innerHTML="Please log into Facebook."}function l(e){var n=a.defer();return t.post("/api/facebook-sign-in",e).success(function(e){n.resolve(e)}),n.promise}function g(e){var t=new Date,o=new Date(t.getFullYear(),t.getMonth()+3,t.getDate());n.put("wigeon_user_img",e,{expires:o})}function p(e){var n={email:e};t.post("/api/forgot-password",n).success(function(e){var t=JSON.parse(e);$(".password-recover-items").hide(),f.forgotPasswordSuccessmessage=t.success_message})}const f=this;f.forgotPassword=p,f.forgotPasswordSuccessmessage="",c(),e.UserLogin=function(e){var t=new FormData;t.append("user_email",e.email),t.append("user_password",e.password),$.ajax({async:!0,crossDomain:!0,url:s.baseApiUrl+"email-login.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t}).done(function(e){var t=JSON.parse(e);void 0!==t.error_name?alert(t.error_name+t.error_message):(setUserCookie(t.user_token,t.user_id),s.IsUserSignedIn(),i.location.href="/#/nest")})},e.facebookLogIn=function(){FB.getLoginStatus(function(e){u(e)})}};SignInCtrl.$inject=["$scope","$http","$cookies","$location","$window","FacebookFactory","$rootScope","$q"],angular.module("WigeonApp").controller("SignInCtrl",SignInCtrl);var SignUpCtrl=function(e,t,n,o,i,r,s){"use strict";function a(e){var t=new Date,o=new Date(t.getFullYear(),t.getMonth()+3,t.getDate());n.put("wigeon_user_token",e,{expires:o}),i.location.href="/#/nest"}e.EmailSignUp=function(e){var t=new FormData;t.append("user_email",e.email),t.append("user_password",e.password),t.append("user_full_name",e.full_name),$.ajax({async:!0,crossDomain:!0,url:"http://52.201.120.48/Wigeon/scripts/email-signup.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t}).done(function(e){var t=JSON.parse(e);void 0!==t.error_name?alert(t.error_name+t.error_message):(a(t.user_token,t.user_id),i.location.href="/#/nest")})}};SignUpCtrl.$inject=["$scope","$http","$cookies","$location","$window","FacebookFactory","$rootScope"],angular.module("WigeonApp").controller("SignUpCtrl",SignUpCtrl);var fbButton=function(e,t){return{link:function(t,n,o){function i(){if(!o.fbButton||t.fbButton||r)e.FB.XFBML.parse(n.parent()[0]);else{console.log("debug this senerio..... fb directive");var r=!0,s=t.$watch("fbButton",function(e,t){e&&(i(),s())})}}e.FB?i():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){e.FB.init({appId:"872785199480947",xfbml:!0,version:"v2.0"}),i()})}}};fbButton.$inject=["$window","$rootScope"],angular.module("WigeonApp").directive("fbButton",fbButton);var imageFallback=function(){var e={link:function(e,t,n){t.bind("error",function(){var e=n.fallbackSrc;angular.element(this).attr("src",e)})}};return e};angular.module("WigeonApp").directive("fallbackSrc",imageFallback);var FacebookFactory=function(e){return{getMyLastName:function(){var t=e.defer();return FB.api("/me",{fields:"name, email"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)}),t.promise}}};FacebookFactory.$inject=["$q"],angular.module("WigeonApp").factory("FacebookFactory",FacebookFactory);var ProfileService=function(e,t,n,o){"use strict";function i(){var t={};return e.get("/api/profile",t).then(function(e){return e.data},function(e){console.error("error: "),console.error(e)})}function r(t,n){var o={params:{calls:t,start:n}};return e.get("/api/profile/suggestions",o).success(function(e){return s(e)})}function s(e){for(var t=0;t<e.length;t++){var n=a(e[t].feed_suggestion.suggestion_type);e[t].feed_suggestion.suggestion_type=n}return e}function a(e){return o.types[e]}const c={getProfile:i,getUserFeed:r};return c};ProfileService.$inject=["$http","$q","$cookies","$rootScope"],angular.module("WigeonApp").service("ProfileService",ProfileService);var SuggestionFactory=function(e,t,n,o){"use strict";function i(n,o){var i=t.defer(),s={calls:n,start:o};return e.post("/api/nest",s).success(function(e){var t=r(e);i.resolve(t)}),i.promise}function r(e){for(var t=0;t<e.length;t++){var n=s(e[t].inbox_suggestion.suggestion_type);e[t].inbox_suggestion.suggestion_type=n}return e}function s(e){return o.types[e]}return{fetch:i}};SuggestionFactory.$inject=["$http","$q","$cookies","$rootScope"],angular.module("WigeonApp").factory("SuggestionFactory",SuggestionFactory);var YelpFactory=function(e,t,n,o){"use strict";function i(n){var o={params:{yelpId:n}},i=t.defer();return e.get("/api/yelp",o).then(function(e){var t=JSON.parse(e.data);i.resolve(t)}),i.promise}return{fetch:i}};YelpFactory.$inject=["$http","$q","$rootScope","$sce"],angular.module("WigeonApp").factory("YelpFactory",YelpFactory);var CutFilter=function(){return function(e,t,n,o){if(!e)return"";if(n=parseInt(n,10),!n)return e;if(e.length<=n)return e;if(e=e.substr(0,n),t){var i=e.lastIndexOf(" ");i!=-1&&("."!=e.charAt(i-1)&&","!=e.charAt(i-1)||(i-=1),e=e.substr(0,i))}return e+(o||" …")}};angular.module("WigeonApp").filter("cut",CutFilter);