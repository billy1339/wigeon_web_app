angular.module("WigeonApp",["ngRoute","ngCookies"]);var appRun=function(e,t,o){e.facebookAppId="U2FsdGVkX1/CiPk3U3ceQZHwQ/nvMdc2p3tqq6gy62g=",e.baseApiUrl="http://52.201.120.48/Wigeon/scripts/",e.types={0:{title:"ALL",id:"0"},1:{title:"WATCH",img:"/assets/images/watch.png",id:"1",color:"#4257A6"},2:{title:"LISTEN",img:"/assets/images/listen.png",id:"2",color:"#F37221"},3:{title:"GO",img:"/assets/images/go.png",id:"3",color:"#FEBC22"},4:{title:"READ",img:"/assets/images/read.png",id:"4",color:"#D83939"},5:{title:"OTHER",img:"/assets/images/other.png",id:"5",color:"#1C706F"}},e.SignOut=function(){t.remove("wigeon_user_token"),o.location.href="/#/"},window.fbAsyncInit=function(){FB.init({appId:CryptoJS.AES.decrypt(e.facebookAppId,"Wigeon").toString(CryptoJS.enc.Utf8),cookie:!0,xfbml:!0,version:"v2.5"}),FB.Event.subscribe("auth.statusChange",function(t){e.$broadcast("fb_statusChange",{status:t.status})})},function(e,t,o){var n,r=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk")};appRun.$inject=["$rootScope","$cookies","$window"],angular.module("WigeonApp").run(appRun);var appRoutes=function(e,t){"use strict";e.when("/",{templateUrl:"views/home.html"}).when("/sign-in",{templateUrl:"views/sign-in.html"}).when("/sign-up",{templateUrl:"views/sign-up.html"}).when("/nest",{templateUrl:"views/nest.html"}).when("/profile",{templateUrl:"views/profile.html"}).otherwise({redirectTo:"/"})};appRoutes.$inject=["$routeProvider","$locationProvider"],angular.module("WigeonApp").config(appRoutes);var NestCtrl=function(e,t,o,n,r,i,a,s){"use strict";function c(){var e=o.get("wigeon_user_token");e||(n.location.href="/#/"),u()}function u(){var t=r.fetch(1,0);t.then(function(t){e.suggestions=t;var o=r.fetch(10,1);o.then(function(t){e.suggestions=e.suggestions.concat(t)})})}function l(t){var o,n;o=e.suggestions;for(var r=0;r<o.length;r++)if(t==o[r].inbox_suggestion.suggestion_id){n=o[r].inbox_suggestion;break}return n}function g(){$(document).ready(function(){$("#NestCtrl").on("hidden.bs.modal","#SuggestionDetailModal",function(){var e=$("#MusicPreview")[0];void 0!==e&&e.pause()}),$(".search-icon .icon").on("click",function(){$(".search-icon").hide(),$(".search-suggestions").show("slow")})})}c(),g(),e.view="GRID",e.quantity=20,e.populateModal=function(t){var o=l(t);if(e.suggestionModelInfo=o,"GO"===o.suggestion_type.title){var n=s.fetch(o.suggestion_source_item_id);n.then(function(t){e.yelp=t,$("#SuggestionDetailModal").modal()})}else $("#SuggestionDetailModal").modal()},e.getIframeSrc=function(e){return a.trustAsResourceUrl("https://www.youtube.com/embed/"+e)},e.returnTrustedSrc=function(e){return e=e+"?cb="+(new Date).getTime(),a.trustAsResourceUrl(e)},e.changeLayout=function(t){$(".layout-buttons a").each(function(){$(this).removeClass("active")}),$("#"+t+"-LAYOUT").addClass("active"),e.view=t},e.seeMore=function(){e.quantity+=20}};NestCtrl.$inject=["$scope","$http","$cookies","$window","SuggestionFactory","$rootScope","$sce","YelpFactory"],angular.module("WigeonApp").controller("NestCtrl",NestCtrl);var ProfileCtrl=function(e,t,o,n,r,i,a,s){"use strict";function c(){var e=o.get("wigeon_user_token");e||(n.location.href="/#/"),u(),l()}function u(){var t=r.fetch();t.then(function(t){console.log(t),e.profile=t})}function l(){var t=r.get(1,0);t.then(function(t){console.log(t),e.suggestions=t;var o=r.get(10,1);o.then(function(t){e.suggestions=e.suggestions.concat(t)})})}function g(t){var o,n;o=e.suggestions;for(var r=0;r<o.length;r++)if(t==o[r].feed_suggestion.suggestion_id){n=o[r].feed_suggestion;break}return n}function p(){$(document).ready(function(){$("#ProfileCtrl").on("hidden.bs.modal","#SuggestionDetailModal",function(){var e=$("#MusicPreview")[0];void 0!==e&&e.pause()}),$(".search-icon .icon").on("click",function(){console.log("hiIIII "),$(".search-icon").hide(),$(".search-suggestions").show("slow")})})}c(),p(),e.view="GRID",e.quantity=20,e.populateModal=function(t){var o=g(t);if(e.suggestionModelInfo=o,"GO"===o.suggestion_type.title){var n=s.fetch(o.suggestion_source_item_id);n.then(function(t){console.log(t),e.yelp=t,$("#SuggestionDetailModal").modal()})}else $("#SuggestionDetailModal").modal()},e.getIframeSrc=function(e){return a.trustAsResourceUrl("https://www.youtube.com/embed/"+e)},e.returnTrustedSrc=function(e){return e=e+"?cb="+(new Date).getTime(),a.trustAsResourceUrl(e)},e.changeLayout=function(t){$(".layout-buttons a").each(function(){$(this).removeClass("active")}),$("#"+t+"-LAYOUT").addClass("active"),e.view=t},e.getProfileImg=function(e){return void 0!==e?-1===e.indexOf("http")?"http://52.201.120.48/Wigeon/"+e:e:void 0},e.seeMore=function(){e.quantity+=20},e.SignOut=function(){o.remove("wigeon_user_token"),n.location.href="/#/"}};ProfileCtrl.$inject=["$scope","$http","$cookies","$window","ProfileFactory","$rootScope","$sce","YelpFactory"],angular.module("WigeonApp").controller("ProfileCtrl",ProfileCtrl);var SignInCtrl=function(e,t,o,n,r,i,a,s){"use strict";function c(){var e=o.get("wigeon_user_token");e&&(r.location.href="/#/nest")}function u(e){if("connected"===e.status){var t=i.getMyLastName();t.then(function(e){var t=l(e);t.then(function(e){e.success?r.location.href="/#/nest":alert(e.error_message)})})}else"not_authorized"===e.status?document.getElementById("status").innerHTML="Please log into this app.":document.getElementById("status").innerHTML="Please log into Facebook."}function l(e){var o=s.defer();return t.post("/api/facebook-sign-in",e).success(function(e){o.resolve(e)}),o.promise}function g(e,t){var n=CryptoJS.AES.encrypt(e+"~"+t,"Wigeon"),r=new Date,i=new Date(r.getFullYear(),r.getMonth()+3,r.getDate());o.put("wigeon_user_token",n,{expires:i})}c(),e.UserLogin=function(e){var t=new FormData;t.append("user_email",e.email),t.append("user_password",e.password),$.ajax({async:!0,crossDomain:!0,url:a.baseApiUrl+"email-login.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t}).done(function(e){var t=JSON.parse(e);void 0!==t.error_name?alert(t.error_name+t.error_message):(g(t.user_token,t.user_id),console.log(t),r.location.href="/#/nest")})},e.facebookLogIn=function(){FB.getLoginStatus(function(e){u(e)})}};SignInCtrl.$inject=["$scope","$http","$cookies","$location","$window","FacebookFactory","$rootScope","$q"],angular.module("WigeonApp").controller("SignInCtrl",SignInCtrl);var SignUpCtrl=function(e,t,o,n,r,i,a){"use strict";function s(e){var t=new Date,n=new Date(t.getFullYear(),t.getMonth()+3,t.getDate());o.put("wigeon_user_token",e,{expires:n}),r.location.href="/#/nest"}e.EmailSignUp=function(e){var t=new FormData;t.append("user_email",e.email),t.append("user_password",e.password),t.append("user_full_name",e.full_name),$.ajax({async:!0,crossDomain:!0,url:"http://52.201.120.48/Wigeon/scripts/email-signup.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:t}).done(function(e){var t=JSON.parse(e);void 0!==t.error_name?alert(t.error_name+t.error_message):(s(t.user_token,t.user_id),r.location.href="/#/nest")})}};SignUpCtrl.$inject=["$scope","$http","$cookies","$location","$window","FacebookFactory","$rootScope"],angular.module("WigeonApp").controller("SignUpCtrl",SignUpCtrl);var fbButton=function(e,t){return{link:function(o,n,r){function i(){if(!r.fbButton||o.fbButton||t)e.FB.XFBML.parse(n.parent()[0]);else{console.log("debug this senerio..... fb directive");var t=!0,a=o.$watch("fbButton",function(e,t){e&&(i(),a())})}}e.FB?i():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){e.FB.init({appId:CryptoJS.AES.decrypt(t.facebookAppId,"Wigeon").toString(CryptoJS.enc.Utf8),xfbml:!0,version:"v2.0"}),i()})}}};fbButton.$inject=["$window","$rootScope"],angular.module("WigeonApp").directive("fbButton",fbButton);var imageFallback=function(){var e={link:function(e,t,o){t.bind("error",function(){var e="http://52.201.120.48/Wigeon/"+o.fallbackSrc;angular.element(this).attr("src",e)})}};return e};angular.module("WigeonApp").directive("fallbackSrc",imageFallback);var FacebookFactory=function(e){return{getMyLastName:function(){var t=e.defer();return FB.api("/me",{fields:"name, email"},function(e){!e||e.error?t.reject("Error occured"):t.resolve(e)}),t.promise}}};FacebookFactory.$inject=["$q"],angular.module("WigeonApp").factory("FacebookFactory",FacebookFactory);var ProfileFactory=function(e,t,o,n){"use strict";function r(){var e=o.get("wigeon_user_token");e=CryptoJS.AES.decrypt(e,"Wigeon").toString(CryptoJS.enc.Utf8).split("~");var n=t.defer(),r=new FormData;return r.append("user_id",e[1]),r.append("requesting_user_id",e[1]),r.append("user_token",e[0]),$.ajax({async:!0,crossDomain:!0,url:"http://52.201.120.48/Wigeon/scripts/fetch-user.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:r}).done(function(e){var t=JSON.parse(e);n.resolve(t)}),n.promise}function i(e){var n=o.get("wigeon_user_token");n=CryptoJS.AES.decrypt(n,"Wigeon").toString(CryptoJS.enc.Utf8).split("~");var r=t.defer(),i=new FormData;return i.append("user_id",n[1]),i.append("requesting_user_id",n[1]),i.append("user_token",n[0]),i.append("page",e),i.append("search_query",""),$.ajax({async:!0,crossDomain:!0,url:"http://52.201.120.48/Wigeon/scripts/fetch-user-feed.php",method:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",data:i}).done(function(e){var t=JSON.parse(e);t=a(t.objects),r.resolve(t)}),r.promise}function a(e){for(var t=0;t<e.length;t++){var o=s(e[t].feed_suggestion.suggestion_type);e[t].feed_suggestion.suggestion_type=o}return e}function s(e){return n.types[e]}return{fetch:r,get:i}};ProfileFactory.$inject=["$http","$q","$cookies","$rootScope"],angular.module("WigeonApp").factory("ProfileFactory",ProfileFactory);var SuggestionFactory=function(e,t,o,n){"use strict";function r(o,n){var r=t.defer(),a={calls:o,start:n};return e.post("/api/nest",a).success(function(e){var t=i(e);r.resolve(t)}),r.promise}function i(e){for(var t=0;t<e.length;t++){var o=a(e[t].inbox_suggestion.suggestion_type);e[t].inbox_suggestion.suggestion_type=o}return e}function a(e){return n.types[e]}return{fetch:r}};SuggestionFactory.$inject=["$http","$q","$cookies","$rootScope"],angular.module("WigeonApp").factory("SuggestionFactory",SuggestionFactory);var YelpFactory=function(e,t,o,n){"use strict";function r(o){var n={params:{yelpId:o}},r=t.defer();return e.get("/api/yelp",n).then(function(e){var t=JSON.parse(e.data);r.resolve(t)}),r.promise}return{fetch:r}};YelpFactory.$inject=["$http","$q","$rootScope","$sce"],angular.module("WigeonApp").factory("YelpFactory",YelpFactory);var CutFilter=function(){return function(e,t,o,n){if(!e)return"";if(o=parseInt(o,10),!o)return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var r=e.lastIndexOf(" ");-1!=r&&("."!=e.charAt(r-1)&&","!=e.charAt(r-1)||(r-=1),e=e.substr(0,r))}return e+(n||" …")}};angular.module("WigeonApp").filter("cut",CutFilter);